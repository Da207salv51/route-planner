<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Studio | Personal Vault</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { background: #0a0a0c; color: #e2e8f0; font-family: 'Inter', sans-serif; }
        .glass { background: rgba(20, 20, 25, 0.9); backdrop-filter: blur(15px); border: 1px solid rgba(255,255,255,0.05); }
        .history-scroll { scrollbar-width: thin; scrollbar-color: #ec4899 #1a1a1a; }
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-thumb { background: #ec4899; border-radius: 10px; }
    </style>
</head>
<body class="min-h-screen flex flex-col md:flex-row">

    <aside class="w-full md:w-80 glass p-6 flex flex-col h-screen sticky top-0 border-r border-white/5">
        <h2 class="text-pink-500 font-black uppercase tracking-widest text-sm mb-6">Il Tuo Vault</h2>
        <div id="history" class="flex-1 overflow-y-auto space-y-4 history-scroll pr-2">
            <p class="text-gray-600 text-xs italic">Nessun elemento salvato...</p>
        </div>
        <button onclick="clearHistory()" class="mt-4 text-[10px] text-gray-500 hover:text-red-500 uppercase transition-colors">Cancella Cronologia</button>
    </aside>

    <main class="flex-1 p-6 md:p-12 flex flex-col items-center">
        <div class="max-w-2xl w-full space-y-8">
            <header class="text-center">
                <h1 class="text-4xl font-extrabold tracking-tighter italic">AI STUDIO <span class="text-pink-600">PRO</span></h1>
            </header>

            <div class="glass rounded-3xl p-6 space-y-4 shadow-2xl">
                <textarea id="prompt" class="w-full bg-black/30 rounded-2xl p-4 border border-white/10 outline-none focus:border-pink-500" placeholder="Descrivi la visione o carica un riferimento..." rows="3"></textarea>
                
                <div class="flex gap-3">
                    <label class="flex-1 flex items-center justify-center gap-2 bg-white/5 hover:bg-white/10 border border-white/10 p-3 rounded-xl cursor-pointer transition-all">
                        <span class="text-sm font-medium">ðŸ“· Carica / Foto</span>
                        <input type="file" id="imageInput" accept="image/*" class="hidden" onchange="handleUpload(this)">
                    </label>
                    
                    <button onclick="generate()" id="genBtn" class="flex-[2] bg-gradient-to-r from-pink-600 to-purple-700 font-bold rounded-xl hover:scale-[1.02] active:scale-95 transition-all">
                        GENERA VISIONE
                    </button>
                </div>
            </div>

            <div id="mainDisplay" class="hidden group relative">
                <div id="loader" class="flex flex-col items-center py-20">
                    <div class="w-10 h-10 border-4 border-pink-500 border-t-transparent rounded-full animate-spin"></div>
                </div>
                <img id="currentImg" class="w-full rounded-2xl shadow-2xl border border-white/10 hidden">
            </div>
        </div>
    </main>

    <script>
        // Carica cronologia all'avvio
        document.addEventListener('DOMContentLoaded', renderHistory);

        function handleUpload(input) {
            const file = input.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    saveToHistory(e.target.result, "Immagine Caricata");
                };
                reader.readAsDataURL(file);
            }
        }

        async function generate() {
            const promptStr = document.getElementById('prompt').value;
            if(!promptStr) return alert("Inserisci un prompt!");

            const genBtn = document.getElementById('genBtn');
            const display = document.getElementById('mainDisplay');
            const loader = document.getElementById('loader');
            const img = document.getElementById('currentImg');

            genBtn.disabled = true;
            display.classList.remove('hidden');
            loader.classList.remove('hidden');
            img.classList.add('hidden');

            const seed = Math.floor(Math.random() * 900000);
            const url = `https://pollinations.ai/p/${encodeURIComponent(promptStr)}?width=1024&height=1536&seed=${seed}&nologo=true`;

            const tempImg = new Image();
            tempImg.src = url;
            tempImg.onload = () => {
                img.src = url;
                loader.classList.add('hidden');
                img.classList.remove('hidden');
                genBtn.disabled = false;
                saveToHistory(url, promptStr);
            };
        }

        function saveToHistory(url, text) {
            let history = JSON.parse(localStorage.getItem('spicy_history') || '[]');
            history.unshift({ url, text, date: new Date().toLocaleString() });
            localStorage.setItem('spicy_history', JSON.stringify(history));
            renderHistory();
        }

        function renderHistory() {
            const container = document.getElementById('history');
            const history = JSON.parse(localStorage.getItem('spicy_history') || '[]');
            
            if(history.length === 0) return;

            container.innerHTML = history.map((item, index) => `
                <div class="glass p-2 rounded-xl border border-white/5 space-y-2">
                    <img src="${item.url}" class="w-full h-32 object-cover rounded-lg cursor-pointer hover:opacity-80" onclick="expandImg('${item.url}')">
                    <p class="text-[10px] text-gray-400 truncate px-1">${item.text}</p>
                    <div class="flex justify-between items-center px-1">
                        <span class="text-[8px] text-gray-600">${item.date}</span>
                        <button onclick="deleteItem(${index})" class="text-[8px] text-red-900 hover:text-red-500">ELIMINA</button>
                    </div>
                </div>
            `).join('');
        }

        function expandImg(url) {
            const img = document.getElementById('currentImg');
            document.getElementById('mainDisplay').classList.remove('hidden');
            document.getElementById('loader').classList.add('hidden');
            img.src = url;
            img.classList.remove('hidden');
        }

        function deleteItem(index) {
            let history = JSON.parse(localStorage.getItem('spicy_history'));
            history.splice(index, 1);
            localStorage.setItem('spicy_history', JSON.stringify(history));
            renderHistory();
        }

        function clearHistory() {
            if(confirm("Vuoi cancellare tutto il vault?")) {
                localStorage.removeItem('spicy_history');
                location.reload();
            }
        }
    </script>
</body>
</html>
